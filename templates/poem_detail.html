{% extends 'base.html' %}
{% block content %}
<article class="poem-detail">
  <div class="bg"
    style="background-image:url('{{ poem.background_image or url_for('static', filename='images/placeholder.svg') }}')">
  </div>
  <div class="poem-box raised">
    <a class="back-link" href="{{ url_for('index') }}">тЖР рд╡рд╛рдкрд╕</a>
    <h1 class="poem-title">{{ poem.title }}</h1>
    <div class="chips">
      <span class="chip">{{ poem.date_added.strftime('%d %B %Y') }}</span>
      <span class="chip">рд╡реНрдпреВрдЬрд╝: {{ poem.view_count }}</span>
      {% if session.get('is_admin') %}
      <form action="{{ url_for('delete_poem', poem_id=poem.id) }}" method="post" style="display:inline;"
        onsubmit="return confirm('рдХреНрдпрд╛ рдЖрдк рд╡рд╛рдХрдИ рдЗрд╕ рдХрд╡рд┐рддрд╛ рдХреЛ рд╣рдЯрд╛рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ?');">
        <button type="submit" class="chip" style="background: #ff4444; color: white; border: none; cursor: pointer;">ЁЯЧСя╕П
          рд╣рдЯрд╛рдПрдВ</button>
      </form>
      {% endif %}
    </div>
    <pre id="poemText" class="poem-text animate-lines">{{ poem.body }}</pre>

    <form class="reactions" method="post" action="{{ url_for('react', poem_id=poem.id) }}">
      <button class="btn shadow" name="action" value="like" {% if not subscriber %}title="рд╕рджрд╕реНрдп рдмрдирдХрд░ рд▓рд╛рдЗрдХ рдХрд░реЗрдВ" {% endif
        %}>ЁЯСН рдкрд╕рдВрдж ({{ likes }})</button>
      <button class="btn light shadow" name="action" value="dislike" {% if not subscriber
        %}title="рд╕рджрд╕реНрдп рдмрдирдХрд░ рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рджреЗрдВ" {% endif %}>ЁЯСО рдирд╛рдкрд╕рдВрдж ({{ dislikes }})</button>
      {% if not subscriber %}
      <a class="btn" href="{{ url_for('subscribe') }}">рд╕рджрд╕реНрдп рдмрдиреЗрдВ</a>
      {% endif %}
    </form>

    <section class="comments">
      <h3>рдЯрд┐рдкреНрдкрдгрд┐рдпрд╛рдБ</h3>
      {% if subscriber %}
      <form method="post" action="{{ url_for('comment', poem_id=poem.id) }}">
        <textarea name="text" rows="3" placeholder="рдЕрдкрдиреА рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рд▓рд┐рдЦреЗрдВтАж"></textarea>
        <button class="btn" type="submit">рдЬреЛрдбрд╝реЗрдВ</button>
      </form>
      {% else %}
      <p><a href="{{ url_for('subscribe') }}">рд╕рджрд╕реНрдп</a> рдмрдиреЗрдВ рдФрд░ рдЯрд┐рдкреНрдкрдгреА рдХрд░реЗрдВред</p>
      {% endif %}
      <ul class="comment-list">
        {% for c in comments %}
        <li>
          <div class="comment-meta">{{ c.created_at.strftime('%d %b %Y %H:%M') }}</div>
          <div class="comment-text">{{ c.text }}</div>
        </li>
        {% else %}
        <li>рдкрд╣рд▓реА рдЯрд┐рдкреНрдкрдгреА рд▓рд┐рдЦреЗрдВред</li>
        {% endfor %}
      </ul>
    </section>
  </div>
</article>
{% endblock %}